(()=>{var b=class t{galleryUID;items=[];constructor(e,r=1){if(window.PhotoSwipe==null||window.PhotoSwipeUI_Default==null){console.error("PhotoSwipe lib not loaded.");return}this.galleryUID=r,t.createGallery(e),this.loadItems(e),this.bindClick()}loadItems(e){this.items=[];let r=e.querySelectorAll("figure.gallery-image");for(let n of r){let i=n.querySelector("figcaption"),o=n.querySelector("img"),c={w:parseInt(o.getAttribute("width")),h:parseInt(o.getAttribute("height")),src:o.src,msrc:o.getAttribute("data-thumb")||o.src,el:n};i&&(c.title=i.innerHTML),this.items.push(c)}}static createGallery(e){let r=e.querySelectorAll("img.gallery-image");for(let o of Array.from(r)){let c=o.closest("p");if(!c||!e.contains(c)||(c.textContent.trim()==""&&c.classList.add("no-text"),!c.classList.contains("no-text")))continue;let d=o.parentElement.tagName=="A",h=o,l=document.createElement("figure");if(l.style.setProperty("flex-grow",o.getAttribute("data-flex-grow")||"1"),l.style.setProperty("flex-basis",o.getAttribute("data-flex-basis")||"0"),d&&(h=o.parentElement),h.parentElement.insertBefore(l,h),l.appendChild(h),o.hasAttribute("alt")){let s=document.createElement("figcaption");s.innerText=o.getAttribute("alt"),l.appendChild(s)}if(!d){l.className="gallery-image";let s=document.createElement("a");s.href=o.src,s.setAttribute("target","_blank"),o.parentNode.insertBefore(s,o),s.appendChild(o)}}let n=e.querySelectorAll("figure.gallery-image"),i=[];for(let o of n)i.length?o.previousElementSibling===i[i.length-1]?i.push(o):i.length&&(t.wrap(i),i=[o]):i=[o];i.length>0&&t.wrap(i)}static wrap(e){let r=document.createElement("div");r.className="gallery";let n=e[0].parentNode,i=e[0];n.insertBefore(r,i);for(let o of e)r.appendChild(o)}open(e){let r=document.querySelector(".pswp");new window.PhotoSwipe(r,window.PhotoSwipeUI_Default,this.items,{index:e,galleryUID:this.galleryUID,getThumbBoundsFn:i=>{let o=this.items[i].el.getElementsByTagName("img")[0],c=window.pageYOffset||document.documentElement.scrollTop,a=o.getBoundingClientRect();return{x:a.left,y:a.top+c,w:a.width}}}).init()}bindClick(){for(let[e,r]of this.items.entries())r.el.querySelector("a").addEventListener("click",i=>{i.preventDefault(),this.open(e)})}},S=b;var u={};if(localStorage.hasOwnProperty("StackColorsCache"))try{u=JSON.parse(localStorage.getItem("StackColorsCache"))}catch{u={}}async function T(t,e,r){if(!t)return await Vibrant.from(r).getPalette();if(!u.hasOwnProperty(t)||u[t].hash!==e){let n=await Vibrant.from(r).getPalette();u[t]={hash:e,Vibrant:{hex:n.Vibrant.hex,rgb:n.Vibrant.rgb,bodyTextColor:n.Vibrant.bodyTextColor},DarkMuted:{hex:n.DarkMuted.hex,rgb:n.DarkMuted.rgb,bodyTextColor:n.DarkMuted.bodyTextColor}},localStorage.setItem("StackColorsCache",JSON.stringify(u))}return u[t]}var U=(t,e=500)=>{t.classList.add("transiting"),t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",window.setTimeout(()=>{t.classList.remove("show"),t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.classList.remove("transiting")},e)},$=(t,e=500)=>{t.classList.add("transiting"),t.style.removeProperty("display"),t.classList.add("show");let r=t.offsetHeight;t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=r+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout(()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.classList.remove("transiting")},e)},Q=(t,e=500)=>window.getComputedStyle(t).display==="none"?$(t,e):U(t,e);function E(){let t=document.getElementById("toggle-menu");t&&t.addEventListener("click",()=>{document.getElementById("main-menu").classList.contains("transiting")||(document.body.classList.toggle("show-menu"),Q(document.getElementById("main-menu"),300),t.classList.toggle("is-active"))})}function F(t,e,r){var n=document.createElement(t);for(let i in e)if(i&&e.hasOwnProperty(i)){let o=e[i];i=="dangerouslySetInnerHTML"?n.innerHTML=o.__html:o===!0?n.setAttribute(i,i):o!==!1&&o!=null&&n.setAttribute(i,o.toString())}for(let i=2;i<arguments.length;i++){let o=arguments[i];o&&n.appendChild(o.nodeType==null?document.createTextNode(o.toString()):o)}return n}var C=F;var v=class{localStorageKey="StackColorScheme";currentScheme;systemPreferScheme;constructor(e){this.bindMatchMedia(),this.currentScheme=this.getSavedScheme(),window.matchMedia("(prefers-color-scheme: dark)").matches===!0?this.systemPreferScheme="dark":this.systemPreferScheme="light",this.dispatchEvent(document.documentElement.dataset.scheme),e&&this.bindClick(e),document.body.style.transition==""&&document.body.style.setProperty("transition","background-color .3s ease")}saveScheme(){localStorage.setItem(this.localStorageKey,this.currentScheme)}bindClick(e){e.addEventListener("click",r=>{this.isDark()?this.currentScheme="light":this.currentScheme="dark",this.setBodyClass(),this.currentScheme==this.systemPreferScheme&&(this.currentScheme="auto"),this.saveScheme()})}isDark(){return this.currentScheme=="dark"||this.currentScheme=="auto"&&this.systemPreferScheme=="dark"}dispatchEvent(e){let r=new CustomEvent("onColorSchemeChange",{detail:e});window.dispatchEvent(r)}setBodyClass(){this.isDark()?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light",this.dispatchEvent(document.documentElement.dataset.scheme)}getSavedScheme(){let e=localStorage.getItem(this.localStorageKey);return e=="light"||e=="dark"||e=="auto"?e:"auto"}bindMatchMedia(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{e.matches?this.systemPreferScheme="dark":this.systemPreferScheme="light",this.setBodyClass()})}},L=v;function y(t){let e;return()=>{e&&window.cancelAnimationFrame(e),e=window.requestAnimationFrame(()=>t())}}var V=".article-content h1[id], .article-content h2[id], .article-content h3[id], .article-content h4[id], .article-content h5[id], .article-content h6[id]",M="#TableOfContents",k="#TableOfContents li",x="active-class";function j(t,e){let r=t.querySelector("a").offsetHeight,n=t.offsetTop-e.offsetHeight/2+r/2-e.offsetTop;n<0&&(n=0),e.scrollTo({top:n,behavior:"smooth"})}function K(t){let e={};return t.forEach(r=>{let i=r.querySelector("a").getAttribute("href");i.startsWith("#")&&(e[i.slice(1)]=r)}),e}function P(t){let e=[];return t.forEach(r=>{e.push({id:r.id,offset:r.offsetTop})}),e.sort((r,n)=>r.offset-n.offset),e}function H(){let t=document.querySelectorAll(V);if(!t){console.warn("No header matched query",t);return}let e=document.querySelector(M);if(!e){console.warn("No toc matched query",M);return}let r=document.querySelectorAll(k);if(!r){console.warn("No navigation matched query",k);return}let n=P(t),i=!1;e.addEventListener("mouseenter",y(()=>i=!0)),e.addEventListener("mouseleave",y(()=>i=!1));let o,c=K(r);function a(){let h=document.documentElement.scrollTop||document.body.scrollTop,l;n.forEach(m=>{h>=m.offset-20&&(l=document.getElementById(m.id))});let s;l&&(s=c[l.id]),l&&!s?console.debug("No link found for section",l):s!==o&&(o&&o.classList.remove(x),s&&(s.classList.add(x),i||j(s,e)),o=s)}window.addEventListener("scroll",y(a));function d(){n=P(t),a()}window.addEventListener("resize",y(d))}var W="a[href]";function I(){document.querySelectorAll(W).forEach(t=>{t.getAttribute("href").startsWith("#")&&t.addEventListener("click",r=>{r.preventDefault();let n=decodeURI(t.getAttribute("href").substring(1)),i=document.getElementById(n),o=i.getBoundingClientRect().top-document.documentElement.getBoundingClientRect().top;window.history.pushState({},"",t.getAttribute("href")),scrollTo({top:o,behavior:"smooth"})})})}var G={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function z(t){return G[t]||t}function g(t){return t.replace(/[&<>"]/g,z)}function J(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var w=class t{data;form;input;list;resultTitle;resultTitleTemplate;constructor({form:e,input:r,list:n,resultTitle:i,resultTitleTemplate:o}){this.form=e,this.input=r,this.list=n,this.resultTitle=i,this.resultTitleTemplate=o,this.input.value.trim()!==""?this.doSearch(this.input.value.split(" ")):this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}static processMatches(e,r,n=!0,i=140,o=20){r.sort((l,s)=>l.start-s.start);let c=0,a=0,d=0,h=[];for(;c<r.length;){let l=r[c];n&&l.start-o>a?(h.push(`${g(e.substring(a,a+o))} [...] `),h.push(`${g(e.substring(l.start-o,l.start))}`),d+=o*2):(h.push(g(e.substring(a,l.start))),d+=l.start-a);let s=c+1,m=l.end;for(;s<r.length&&r[s].start<=m;)m=Math.max(r[s].end,m),++s;if(h.push(`<mark>${g(e.substring(l.start,m))}</mark>`),d+=m-l.start,c=s,a=m,n&&d>i)break}if(a<e.length){let l=e.length;n&&(l=Math.min(l,a+o)),h.push(`${g(e.substring(a,l))}`),n&&l!=e.length&&h.push(" [...]")}return h.join("")}async searchKeywords(e){let r=await this.getData(),n=[],i=new RegExp(e.filter((o,c,a)=>(a[c]=J(o),o.trim()!=="")).join("|"),"gi");for(let o of r){let c=[],a=[],d={...o,preview:"",matchCount:0},h=o.content.matchAll(i);for(let s of Array.from(h))a.push({start:s.index,end:s.index+s[0].length});let l=o.title.matchAll(i);for(let s of Array.from(l))c.push({start:s.index,end:s.index+s[0].length});c.length>0&&(d.title=t.processMatches(d.title,c,!1)),a.length>0?d.preview=t.processMatches(d.content,a):d.preview=g(d.content.substring(0,140)),d.matchCount=c.length+a.length,d.matchCount>0&&n.push(d)}return n.sort((o,c)=>c.matchCount-o.matchCount)}async doSearch(e){let r=performance.now(),n=await this.searchKeywords(e);this.clear();for(let o of n)this.list.append(t.render(o));let i=performance.now();this.resultTitle.innerText=this.generateResultTitle(n.length,((i-r)/1e3).toPrecision(1)),pjax.refresh(document)}generateResultTitle(e,r){return this.resultTitleTemplate.replace("#PAGES_COUNT",e).replace("#TIME_SECONDS",r)}async getData(){if(!this.data){let e=this.form.dataset.json;this.data=await fetch(e).then(n=>n.json());let r=new DOMParser;for(let n of this.data)n.content=r.parseFromString(n.content,"text/html").body.innerText}return this.data}bindSearchForm(){let e="",r=n=>{n.preventDefault();let i=this.input.value.trim();if(t.updateQueryString(i,!0),i==="")return e="",this.clear();e!==i&&(e=i,this.doSearch(i.split(" ")))};this.input.addEventListener("input",r),this.input.addEventListener("compositionend",r)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",e=>{this.handleQueryString()})}handleQueryString(){let r=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=r,r?this.doSearch(r.split(" ")):this.clear()}static updateQueryString(e,r=!1){let n=new URL(window.location.toString());e===""?n.searchParams.delete("keyword"):n.searchParams.set("keyword",e),r?window.history.replaceState("","",n.toString()):window.history.pushState("","",n.toString())}static render(e){return createElement("article",null,createElement("a",{href:e.permalink},createElement("div",{class:"article-details"},createElement("h2",{class:"article-title",dangerouslySetInnerHTML:{__html:e.title}}),createElement("section",{class:"article-preview",dangerouslySetInnerHTML:{__html:e.preview}})),e.image&&createElement("div",{class:"article-image"},createElement("img",{src:e.image,loading:"lazy"}))))}};function A(){if(document.querySelector(".search-result")){let e=document.querySelector(".search-form"),r=e.querySelector("input"),n=document.querySelector(".search-result--list"),i=document.querySelector(".search-result--title");new w({form:e,input:r,list:n,resultTitle:i,resultTitleTemplate:window.searchResultTitleTemplate})}}var f=class t{static instance;colorMap={};colors=["#8ea885","#df7988","#0177b8","#ffb900","#6b69d6","#e86c60","#1abc9c","#9b59b6","#3498db","#e67e22","#2ecc71","#e74c3c","#f1c40f","#16a085","#d35400","#7f8c8d","#2c3e50","#c0392b","#27ae60","#8e44ad"];textColor="#ffffff";constructor(){}static getInstance(){return t.instance||(t.instance=new t),t.instance}hashCode(e){let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);r=(r<<5)-r+i,r=r&r}return Math.abs(r)}generateColor(e){let r=this.hashCode(e),n=r%360,i=65+r%25,o=45+r%15;return`hsl(${n}, ${i}%, ${o}%)`}getCategoryColor(e){if(this.colorMap[e])return this.colorMap[e];let r=Object.keys(this.colorMap).length,n;return r<this.colors.length?n=this.colors[r]:n=this.generateColor(e),this.colorMap[e]=n,n}applyCategoryColors(){document.querySelectorAll(".article-category a").forEach(r=>{let n=r,i=n.textContent?.trim();if(i){let o=this.getCategoryColor(i);n.style.backgroundColor=o,n.style.color=this.textColor,n.style.setProperty("background-color",o,"important"),n.style.setProperty("color",this.textColor,"important")}})}};document.addEventListener("DOMContentLoaded",()=>{let t=f.getInstance();t.applyCategoryColors(),new MutationObserver(()=>{t.applyCategoryColors()}).observe(document.body,{childList:!0,subtree:!0})});window.addEventListener("load",()=>{f.getInstance().applyCategoryColors()});var D=f;var q={init:()=>{A(),D.getInstance().applyCategoryColors(),E();let e=document.querySelector(".article-content");e&&(new S(e),I(),H());let r=document.querySelector(".article-list--tile");r&&new IntersectionObserver(async(a,d)=>{a.forEach(h=>{if(!h.isIntersecting)return;d.unobserve(h.target),h.target.querySelectorAll("article.has-image").forEach(async s=>{let m=s.querySelector("img"),B=m.src,N=m.getAttribute("data-key"),O=m.getAttribute("data-hash"),R=s.querySelector(".article-details"),p=await T(N,O,B);R.style.background=`
                        linear-gradient(0deg, 
                            rgba(${p.DarkMuted.rgb[0]}, ${p.DarkMuted.rgb[1]}, ${p.DarkMuted.rgb[2]}, 0.5) 0%, 
                            rgba(${p.Vibrant.rgb[0]}, ${p.Vibrant.rgb[1]}, ${p.Vibrant.rgb[2]}, 0.75) 100%)`})})}).observe(r);let n=document.querySelectorAll(".article-content div.highlight"),i="Copy",o="Copied!";n.forEach(c=>{let a=document.createElement("button");a.innerHTML=i,a.classList.add("copyCodeButton"),c.appendChild(a);let d=c.querySelector("code[data-lang]");d&&a.addEventListener("click",()=>{navigator.clipboard.writeText(d.textContent).then(()=>{a.textContent=o,setTimeout(()=>{a.textContent=i},1e3)}).catch(h=>{alert(h),console.log("Something went wrong",h)})})}),new L(document.getElementById("dark-mode-toggle"))}};window.addEventListener("load",()=>{setTimeout(function(){q.init()},0)});window.Stack=q;window.createElement=C;})();
/*!
*   Hugo Theme Stack
*
*   @author: Jimmy Cai
*   @website: https://jimmycai.com
*   @link: https://github.com/CaiJimmy/hugo-theme-stack
*/
